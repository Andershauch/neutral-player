generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// --- NY MODEL: BRUGERE ---
model User {
  id            String    @id @default(cuid())
  name          String?
  email         String    @unique
  emailVerified DateTime?
  image         String?
  password      String?   // Bruges til Email/Password login
  role          String    @default("contributor") // "admin" eller "contributor"
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

// --- EKSISTERENDE MODELLER ---
model Embed {
  id             String   @id @default(cuid())
  name           String
  thumbnailUrl   String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  
  // Domæne whitelisting
  allowedDomains String?  @default("*") 
  
  // Relationer
  groups         Group[]
}

model Group {
  id        String    @id @default(cuid())
  name      String
  sortOrder Int       @default(0)
  embedId   String
  // Cascade delete: Sletter gruppen hvis projektet (Embed) slettes
  embed     Embed     @relation(fields: [embedId], references: [id], onDelete: Cascade)
  variants  Variant[]
}

model Variant {
  id             String   @id @default(cuid())
  title          String?
  lang           String   @default("da")
  sortOrder      Int      @default(0)
  
  // Mux specifikke felter
  muxUploadId    String?  
  muxPlaybackId  String?  
  muxAssetId     String?

  dreamBrokerUrl String?
  
  // Statistik
  views          Int      @default(0)

  // Relation til Group
  groupId        String
  // Cascade delete: Sletter varianten hvis gruppen slettes
  group          Group    @relation(fields: [groupId], references: [id], onDelete: Cascade)
  
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model AuditLog {
  id        String   @id @default(cuid())
  userId    String?   // ID på den person der udførte handlingen
  userName  String?   // Navn eller e-mail for nem læsning
  action    String   // f.eks. "DELETE_PROJECT", "CREATE_VARIANT"
  target    String   // f.eks. projektets navn eller ID
  createdAt DateTime @default(now())
}